# [2024_06_08]

### [트랜잭션]

트랜잭션이란 ‘**더이상 분할이 불가능한 업무처리의 단위**’를 의미한다.

한꺼번에 **수행되어야 할 일련의 연산모음**을 의미한다.

만약 A가 B에게 송금을 하였는데 A는 송금에 성공하였지만, B는 입금에 실패했다하면 안된다.

그러므로 이러한 과정은 **동시에 성공하던지, 동시에 실패해야 한다**.

이러한 과정같이 데이터 거래에 있어서 안정성을 확보하기 위해 하나의 과정으로 묶는 것이 **트랜잭션**이다.

따라서 트랜잭션 과정을 통해 오류**가 발생한다면 모든 작업을 원상태로 복구(RollBack)하고,** 정상적으로 처리가 된다면 그 결과를 반영**한다.**

데이터베이스에서 CRUD 과정을 통해 값(상태)를 바꿔주는 것 또한 일종의 트랜잭션이다.

잘못된 Query를 작성하게 된다면 실제 반영이 안되기 때문이다.

> git의 commit기능 시 오류가 발생하면 반영이 안되는 것과 같다.
>

이러한 트랜잭션 과정은 **사용자가 원하는 기준에 따라 작업단위를 나눌 수 있다**.

> 예를 들어 사용자가 여행 게시판 중 여행 후기 게시판에 글을 작성하고 싶다면
1) 메인 페이지에서 게시판 접속(SELECT)
2) 게시판에서 여행 후기 게시판 선택(SELECT)
3) 여행 후기 게시판에 해당하는 내용이 출력(SELECT)
4) 게시글 작성
5) 해당 게시판에 게시글이 데이터베이스 등록(INSERT)

이러한 과정들을 통해 **4개의 과정을 하나의 트랜잭션으로 분류 할 수도 있다**.

### 트랜잭션 특징

트랜잭션은 크게 4가지로 분류된다.

1. 원자성
   - 원자성은 트랜잭션이 데이터베이스에 모두 반영되던가, 아니면 전혀 반영되지 않아야 한다.
2. 일관성
   - 트랜잭션이 진행되는 동안에 DB가 변경되더라도 업데이트된 DB가 아닌, 기존의 트랜잭션을 진행 하기 위해 참조항 DB로 진행되야 한다.
3. 독립성
   - 트랜잭션이 2개 이상 실행되고 있다면 서로 다른 트랜잭션끼리 접근할 수 없다는것을 말한다.
4. 영구성
   - 트랜잭션이 성공적으로 처리됬다면 결과는 영구적으로 반영되야한다.

### 트랜잭션 예외

모든 명령어는 트랜잭션의 Rollback 처리가 되지 않는다.

DDL(CREATE, DROP, ALTER, RENAME, TRUNCATE)는 대상이 아니다.

Spring Boot에서 @Transactional어노테이션이 붙을 경우 해당 로직이 유효하지 않을 경우 Rollback 처리가 된다.

잘못 알고 있던 사실 : **프로젝트 진행했을 때 @Transactional 어노테이션을 붙인 메소드가 Rollback처리가 되는 줄 알았으나 오류가 발생하며 Rollback처리가 된다는 것을 알게 되었다.**